<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mermaid Flowchart - Fixed</title>
    <!-- 使用你确认可行的版本 -->
    <script src="https://unpkg.com/mermaid@10.9.0/dist/mermaid.min.js"></script>
    <script>
        // 使用基本初始化，确保 startOnLoad 为 true
        mermaid.initialize({
            startOnLoad: true,
            logLevel: 1, // 1=debug, 4=warn, 5=error
            theme: 'neutral', // 'default', 'forest', 'dark', 'neutral', 'base'
            // 可以根据需要加回 flowchart 的特定配置
            flowchart: {
               useMaxWidth: true,
               htmlLabels: true, // 保持为 true，因为你的标签包含中文和括号
               curve: 'basis'
            },
            // 安全级别，如果内容都来自你本地，'loose' 通常没问题
            // 如果渲染外部内容，应考虑 'strict' 或 'antiscript'
            securityLevel: 'loose'
        });
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .mermaid {
            display: flex;
            justify-content: center;
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            min-height: 400px; /* 保持足够高度 */
            overflow: auto;    /* 允许滚动 */
            box-sizing: border-box;
        }
        #error {
            color: red;
            font-weight: bold;
            margin-bottom: 10px;
            min-height: 1em;
        }
    </style>
</head>
<body>
    <h1>AI-Powered Network Operations Architecture</h1>
    <div id="error"></div> <!-- 用于显示潜在的JS错误 -->

    <!-- Mermaid 图表容器 -->
    <div class="mermaid">
        graph TD
            subgraph "数据源 (Data Sources)"
                A[原始流量 (可选, 抽样)];          %% <-- 添加分号
                B[网元内置探针 (CHR/UFDR)];       %% <-- 添加分号
                C[外部探针 (XDR)];                %% <-- 添加分号
                D[网元日志 (Logs)];               %% <-- 添加分号
                E[性能计数器 (PM Counters)];      %% <-- 添加分号
                F[网络配置 (Configuration)];      %% <-- 添加分号
                G[告警数据 (Alarms)];             %% <-- 添加分号
                H[用户投诉/工单 (Tickets)];       %% <-- 添加分号
            end

            subgraph "数据湖/统一存储 (Data Lake / Unified Storage)"
                I[统一数据存储 (Raw & Processed)]; %% <-- 添加分号
            end

            subgraph "数据预处理与特征工程 (Preprocessing & Feature Engineering)"
                J[数据清洗与规范化];               %% <-- 添加分号
                K[多源数据关联与融合];             %% <-- 添加分号
                L[AI驱动的特征提取/生成];         %% <-- 添加分号
            end

            subgraph "AI 分析引擎 (AI Analysis Engine)"
                M[无监督学习 (Anomaly Detection, Clustering)]; %% <-- 添加分号
                O[监督/自监督学习 (Prediction, Classification)]; %% <-- 添加分号
                P[深度学习模型 (RNN/LSTM/Transformer, GNN)];  %% <-- 添加分号
                Q[强化学习 (Optimization, Policy Recommendation)]; %% <-- 添加分号
                R[大语言模型/生成式AI (NLP Interface, Report Generation)]; %% <-- 添加分号
            end

            subgraph "知识与洞察层 (Knowledge & Insight Layer)"
                N[知识图谱 / AI模型库];            %% <-- 添加分号
                S[实时/离线指标计算];             %% <-- 添加分号
                T[智能告警与根因分析];             %% <-- 添加分号
                U[趋势预测与风险评估];             %% <-- 添加分号
                V[用户画像与行为分析];             %% <-- 添加分号
                W[网络优化建议];                 %% <-- 添加分号
            end

            subgraph "应用与交互层 (Application & Interaction Layer)"
                X[智能可视化仪表盘];               %% <-- 添加分号
                Y[自然语言查询接口];               %% <-- 添加分号
                Z[自动化报告生成];                 %% <-- 添加分号
                AA[API for Orchestration/Automation]; %% <-- 添加分号
                BB[运维专家交互界面 (含XAI解释)];  %% <-- 添加分号
            end

            %% 数据流向 (连接语句后加分号是可选的，换行通常足够)
            A --> I; B --> I; C --> I; D --> I; E --> I; F --> I; G --> I; H --> I;
            I --> J; J --> K; K --> L;
            L --> M; L --> O; L --> P; L --> Q; L --> R;

            %% AI引擎贡献到知识与洞察 (使用 --- 表示非直接数据流)
            M --- N; O --- N; P --- N; Q --- N; R --- N;  %% 表示贡献或关联到知识库
            M --> T; M --> V;
            O --> S; O --> T; O --> U; O --> V;
            P --> S; P --> T; P --> U; P --> V;
            Q --> W;
            R --> Y; R --> Z; %% LLM支撑NLQ和报告生成

            %% 知识库支撑洞察层
            N --> S; N --> T; N --> U; N --> V; N --> W;
            N --> BB; %% 知识库信息也可供专家参考

            %% 洞察层驱动应用层
            S --> X; T --> X; U --> X; V --> X; W --> X; %% 洞察结果可视化
            T --> AA; W --> AA; %% 告警/优化建议驱动自动化

            %% 应用层交互与反馈
            X --> BB; Y --> BB; Z --> BB; AA --> BB; %% 各应用组件汇聚到专家界面
            BB -- Feedback --> O; BB -- Feedback --> P; BB -- Feedback --> Q; %% 专家反馈用于模型优化
    </div>

    <!-- (可选) 用于在页面上显示错误的脚本 -->
    <script>
        window.mermaidParseError = function(err, hash) {
           console.error('Mermaid Parse Error Detected:', err, hash);
           const errorDiv = document.getElementById('error');
           if (errorDiv) {
               let message = err instanceof Error ? err.message : String(err);
               // 尝试清理错误信息
               message = message.replace(/Parse error on line \d+:\n.*/s, 'Diagram Syntax Error. Check console for details.');
               errorDiv.innerText = 'Mermaid Diagram Error: ' + message;
           }
        };
    </script>

</body>
</html>
