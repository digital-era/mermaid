<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mermaid Flowchart</title>
    <script src="https://unpkg.com/mermaid@10.9.3/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            logLevel: 1, // Verbose debugging (1 = debug)
            theme: 'neutral',
            securityLevel: 'loose',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });
        // Log parsing errors
        mermaid.parseError = function(err, hash) {
            console.error('Mermaid Parse Error:', err, hash);
        };
    </script>
    <style>
        .mermaid {
            display: flex;
            justify-content: center;
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            min-height: 400px;
            overflow-x: auto;
        }
        body { font-family: Arial, sans-serif; }
        #error { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <div id="error"></div>
    <div class="mermaid">
        graph TD
            subgraph 数据源
                A[原始流量]
                B[CHR/UFDR]
                C[XDR]
                D[日志]
                E[计数器]
                F[配置]
                G[告警]
                H[工单]
            end

            subgraph 数据湖
                I[统一存储]
            end

            subgraph 预处理
                J[清洗]
                K[融合]
                L[特征提取]
            end

            subgraph AI引擎
                M[无监督学习] --> N[知识图谱]
                O[监督学习] --> N
                P[深度学习] --> N
                Q[强化学习] --> N
                R[生成式AI] --> N
            end

            subgraph 洞察层
                N[知识图谱]
                S[指标计算]
                T[告警分析]
                U[趋势预测]
                V[用户画像]
                W[优化建议]
            end

            subgraph 应用层
                X[仪表盘]
                Y[语言接口]
                Z[报告生成]
                AA[API]
                BB[运维界面]
            end

            A --> I; B --> I; C --> I; D --> I; E --> I; F --> I; G --> I; H --> I
            I --> J; J --> K; K --> L
            L --> M; L --> O; L --> P; L --> Q; L --> R
            M --> T; M --> V
            O --> S; O --> T; O --> U; O --> V
            P --> S; P --> T; P --> U; P --> V
            Q --> W
            R --> Y; R --> Z

            N --> S; N --> T; N --> U; N --> V; N --> W; N --> BB
            S --> X; T --> X; U --> X; V --> X; W --> X
            T --> AA; W --> AA
            Y --> R; Z --> R
            X --> BB; Y --> BB; Z --> BB; AA --> BB

            BB -->|Feedback| O
            BB -->|Feedback| P
            BB -->|Feedback| Q
    </div>
    <script>
        // Display errors in HTML
        mermaid.parseError = function(err, hash) {
            document.getElementById('error').innerText = 'Mermaid Error: ' + err;
        };
    </script>
</body>
</html>
